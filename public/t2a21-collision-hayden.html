<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>t2a21-collision-hayden</title>

<style>
    body {
        margin: 0;
        overflow: hidden;
        background: #eef;
    }

    #myImg01, #myImg02 {
        position: absolute;
        width: 100px;
        height: 100px;
    }
</style>
</head>
<body>

<!-- Player and enemy -->
<img id="myImg01" src="ignore/BaskingShark.jpg" style="left:20px; top:20px;">
<img id="myImg02" src="ignore/pukeko.jpg" style="left:300px; top:200px;">

<script>
// ------------------------------
// BOUNDING BOX
// ------------------------------
function getBox(id) {
    return document.getElementById(id).getBoundingClientRect();
}

// ------------------------------
// COLLISION DETECTION
// ------------------------------
function hit(id1, id2) {
    const a = getBox(id1);
    const b = getBox(id2);

    return !(
        a.right < b.left ||
        a.left > b.right ||
        a.bottom < b.top ||
        a.top > b.bottom
    );
}

// ------------------------------
// SMOOTH MOVEMENT
// ------------------------------
const keys = {};
const speed = 5;

document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup",   e => keys[e.key] = false);

// ------------------------------
// GAME LOOP
// ------------------------------
function gameLoop() {
    const player = document.getElementById("myImg01");
    const enemy  = document.getElementById("myImg02");

    // Player old position
    let pLeft = parseInt(player.style.left);
    let pTop  = parseInt(player.style.top);

    let pOldLeft = pLeft;
    let pOldTop  = pTop;

    // Enemy old position
    let eLeft = parseInt(enemy.style.left);
    let eTop  = parseInt(enemy.style.top);

    // -------------------------
    // MOVE PLAYER
    // -------------------------
    if (keys["ArrowUp"]    || keys["w"] || keys["W"]) pTop  -= speed;
    if (keys["ArrowDown"]  || keys["s"] || keys["S"]) pTop  += speed;
    if (keys["ArrowLeft"]  || keys["a"] || keys["A"]) pLeft -= speed;
    if (keys["ArrowRight"] || keys["d"] || keys["D"]) pLeft += speed;

    // Keep player in bounds
    const maxLeft = window.innerWidth  - player.offsetWidth;
    const maxTop  = window.innerHeight - player.offsetHeight;

    pLeft = Math.max(0, Math.min(pLeft, maxLeft));
    pTop  = Math.max(0, Math.min(pTop, maxTop));

    // Apply player movement
    player.style.left = pLeft + "px";
    player.style.top  = pTop + "px";

    // -------------------------
    // HANDLE COLLISION + PUSH
    // -------------------------
    if (hit("myImg01", "myImg02")) {

        // Determine push direction
        let dx = pLeft - pOldLeft; // movement direction X
        let dy = pTop - pOldTop;   // movement direction Y

        // Push enemy the same amount
        eLeft += dx;
        eTop  += dy;

        // Enemy boundaries
        const eMaxLeft = window.innerWidth  - enemy.offsetWidth;
        const eMaxTop  = window.innerHeight - enemy.offsetHeight;

        eLeft = Math.max(0, Math.min(eLeft, eMaxLeft));
        eTop  = Math.max(0, Math.min(eTop, eMaxTop));

        // Apply enemy movement
        enemy.style.left = eLeft + "px";
        enemy.style.top  = eTop  + "px";

        console.log("PUSH!");
    }

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
