<!DOCTYPE html>
<html>
<head>
<title>Shark Hunter: Boss Update</title>
<style>
    body { background-color: #004d7a; overflow:hidden; margin:0; font-family: 'Segoe UI', sans-serif; }
    
    #menu, #overlay, #shopOverlay, #victoryOverlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,20,40,0.9); color: white; text-align: center; 
        padding-top: 10%; z-index: 200;
    }
    #overlay, #victoryOverlay { display: none; } 

    /* UI Elements */
    #healthContainer {
        position: fixed; top: 20px; left: 20px; width: 200px; height: 25px; 
        background: #333; border: 2px solid white; z-index: 50;
    }
    #healthBar { width: 100%; height: 100%; background: #4CAF50; transition: width 0.3s; }
    
    /* Boss Health Bar */
    #bossUI {
        position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
        width: 400px; display: none; text-align: center; z-index: 100;
    }
    #bossHealthContainer { width: 100%; height: 20px; background: #333; border: 2px solid #ff4444; }
    #bossHealthBar { width: 100%; height: 100%; background: #ff4444; transition: width 0.2s; }
    #bossUI label { color: white; font-weight: bold; text-transform: uppercase; display: block; margin-bottom: 5px; }

    .stats { 
        position: fixed; top: 10px; right: 20px; color: white; text-align: right;
        background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; font-size: 16px;
    }
    .best { color: #ffd700; font-weight: bold; font-size: 14px; }

    .harpoon {
        position: absolute; width: 40px; height: 6px; 
        background: linear-gradient(to right, #888, #eee, #333);
        border-radius: 2px; left: -500px; pointer-events: none;
    }
    .harpoon::after { 
        content: ''; position: absolute; right: -5px; top: -3px;
        border-left: 10px solid #555; border-top: 6px solid transparent; border-bottom: 6px solid transparent;
    }

    button { padding: 15px 30px; font-size: 18px; cursor: pointer; margin: 10px; background: #008CBA; color: white; border: none; border-radius: 8px; }
    .shop-item { display: inline-block; width: 200px; padding: 15px; border: 1px solid #008CBA; margin: 10px; background: rgba(255,255,255,0.1); }
</style>
<script>
   let myGold = 10;
   let playerHealth = 10;
   let playerMaxHealth = 10;
   let bossHP = 15;
   let bossMaxHP = 15;
   let gameActive = false;
   let inShop = false;
   let endlessMode = false;
   let wave = 1;
   let enemyBaseSpeed = 0.8;
   let tripleShot = false;
   let playerSpeed = 25;
   let activeEnemies = [];

   function fixImg(el, name, color) {
       el.onerror = null;
       el.src = `https://placehold.co/100x60/${color}/white?text=${name}`;
   }

   function updateUI() {
       document.getElementById('healthBar').style.width = Math.max(0, (playerHealth / playerMaxHealth) * 100) + "%";
       
       // Handle Boss UI
       let bUI = document.getElementById('bossUI');
       let boss = document.getElementById('bossShark');
       if (boss.style.display !== 'none') {
           bUI.style.display = 'block';
           document.getElementById('bossHealthBar').style.width = Math.max(0, (bossHP / bossMaxHP) * 100) + "%";
       } else {
           bUI.style.display = 'none';
       }

       let bWave = localStorage.getItem('sharkBestWave') || 0;
       let bGold = localStorage.getItem('sharkBestGold') || 0;
       document.getElementById('waveDisplay').innerText = endlessMode ? "Wave: " + wave : "Story Mode";
       document.getElementById('scoreDisplay').innerText = "Gold: " + myGold;
       document.getElementById('highScoreDisplay').innerHTML = `<span class="best">BEST WAVE: ${bWave}</span><br><span class="best">BEST GOLD: ${bGold}</span>`;
   }

   function selectMode(isEndless) {
       endlessMode = isEndless;
       document.getElementById('menu').style.display = 'none';
       gameActive = true;
       if (endlessMode) { 
           wave = 0; startWave(); 
       } else {
           document.getElementById('myImg04').style.display = 'block';
           document.getElementById('bossShark').style.display = 'block';
           bossHP = 15; bossMaxHP = 15;
       }
       updateUI();
   }

   function spawnShark(id) {
       let img = document.createElement('img');
       img.id = id;
       img.src = "ignore/BaskingShark.jpg";
       img.onerror = function() { fixImg(this, 'Shark', '224466'); };
       img.style.position = "absolute"; img.style.width = "80px"; img.style.height = "40px";
       img.style.left = (window.innerWidth + Math.random() * 500) + "px";
       img.style.top = Math.random() * (window.innerHeight - 100) + "px";
       document.body.appendChild(img);
       activeEnemies.push(id);
   }

   function startWave() {
       wave++;
       enemyBaseSpeed += 0.15;
       activeEnemies.forEach(id => { let e = document.getElementById(id); if (e) e.remove(); });
       activeEnemies = [];
       for (let i = 0; i < 3 + wave; i++) spawnShark('shark' + i);
       if (wave % 5 === 0) {
           let b = document.getElementById('bossShark');
           b.style.display = 'block'; b.style.left = "1200px";
           bossMaxHP = 10 + (wave * 2); bossHP = bossMaxHP;
       }
       updateUI();
   }

   function myHitOther(my1, my2) {
       const b1 = document.getElementById(my1).getBoundingClientRect();
       const b2 = document.getElementById(my2).getBoundingClientRect();
       return !(b1.right < b2.left || b1.left > b2.right || b1.bottom < b2.top || b1.top > b2.bottom);
   }

   function myShoot(event) {
       if (!gameActive || inShop) return;
       let p = document.getElementById('myImg01').getBoundingClientRect();
       let sX = p.left + 30, sY = p.top + 30;
       let dX = event.clientX - sX, dY = event.clientY - sY;
       let angle = Math.atan2(dY, dX);
       let dist = Math.sqrt(dX*dX + dY*dY);
       let vX = (dX/dist)*22, vY = (dY/dist)*22; // Faster projectile speed

       fireHarpoon('hp1', sX, sY, vX, vY, angle);
       if (tripleShot) {
           fireHarpoon('hpB', sX, sY, vX, vY - 2, angle - 0.1);
           fireHarpoon('hpC', sX, sY, vX, vY + 2, angle + 0.1);
       }
   }

   function fireHarpoon(id, sX, sY, vX, vY, angle) {
       let h = document.getElementById(id);
       h.style.left = sX + 'px'; h.style.top = sY + 'px';
       h.style.transform = `rotate(${angle}rad)`;
       
       let lifespan = 0;
       let timer = setInterval(() => {
           lifespan++;
           if (!gameActive || lifespan > 100) { clearInterval(timer); h.style.left = "-500px"; return; }
           
           h.style.left = parseFloat(h.style.left) + vX + 'px';
           h.style.top = parseFloat(h.style.top) + vY + 'px';
           
           activeEnemies.forEach((eId, index) => {
               if (myHitOther(id, eId)) { h.style.left = "-500px"; clearInterval(timer); killEnemy(eId, index); }
           });
           
           let boss = document.getElementById('bossShark');
           if (boss.style.display !== 'none' && myHitOther(id, 'bossShark')) {
               h.style.left = "-500px"; clearInterval(timer); 
               bossHP--; updateUI();
               if (bossHP <= 0) { 
                   boss.style.display = 'none'; myGold += 50; updateUI();
                   if (!endlessMode) { gameActive = false; document.getElementById('victoryOverlay').style.display = 'block'; }
               }
           }
       }, 20);
   }

   function killEnemy(id, index) {
       let e = document.getElementById(id); if (e) e.remove();
       activeEnemies.splice(index, 1);
       myGold += 5; updateUI();
       if (endlessMode && activeEnemies.length === 0) { if (wave % 2 === 0) openShop(); else startWave(); }
   }

   function openShop() { inShop = true; document.getElementById('shopOverlay').style.display = 'block'; document.getElementById('shopGold').innerText = myGold; }
   function closeShop() { inShop = false; document.getElementById('shopOverlay').style.display = 'none'; startWave(); }
   
   function buy(item) {
       if (item === 'health' && myGold >= 5) { myGold -= 5; playerHealth = playerMaxHealth; }
       else if (item === 'speed' && myGold >= 10) { myGold -= 10; playerSpeed += 8; }
       else if (item === 'triple' && myGold >= 15) { myGold -= 15; tripleShot = true; }
       updateUI(); document.getElementById('shopGold').innerText = myGold;
   }

   // MAIN LOOP
   setInterval(() => {
       if (!gameActive || inShop) return;
       let p = document.getElementById('myImg01');
       let px = parseFloat(p.style.left), py = parseFloat(p.style.top);
       
       // Gravity
       if (py < window.innerHeight - 80) p.style.top = (py + 1.5) + 'px';
       
       // Boss Movement
       let boss = document.getElementById('bossShark');
       if (boss.style.display !== 'none') {
           let bx = parseFloat(boss.style.left), by = parseFloat(boss.style.top);
           boss.style.left = (bx < px ? bx + (enemyBaseSpeed * 0.7) : bx - (enemyBaseSpeed * 0.7)) + 'px';
           boss.style.top = (by < py ? by + (enemyBaseSpeed * 0.7) : by - (enemyBaseSpeed * 0.7)) + 'px';
           if (myHitOther('myImg01', 'bossShark')) { playerHealth -= 0.1; updateUI(); }
       }

       // Shark Movement
       activeEnemies.forEach(id => {
           let e = document.getElementById(id); if(!e) return;
           let ex = parseFloat(e.style.left), ey = parseFloat(e.style.top);
           e.style.left = (ex < px ? ex + enemyBaseSpeed : ex - enemyBaseSpeed) + 'px';
           e.style.top = (ey < py ? ey + enemyBaseSpeed : ey - enemyBaseSpeed) + 'px';
           if (myHitOther('myImg01', id)) { playerHealth -= 1; e.style.left = (ex + 200) + 'px'; updateUI(); }
       });

       if (playerHealth <= 0) { gameActive = false; document.getElementById('overlay').style.display='block'; }
   }, 40);
</script>
</head>

<body onclick="myShoot(event)" onkeydown="
    if(!gameActive || inShop) return;
    let p = document.getElementById('myImg01');
    let x = parseFloat(p.style.left), y = parseFloat(p.style.top);
    if (event.key == 'd' && x < window.innerWidth - 60) p.style.left = (x + playerSpeed) + 'px';
    if (event.key == 'a' && x > 0) p.style.left = (x - playerSpeed) + 'px';
    if (event.key == 'w' && y > 0) p.style.top = (y - 60) + 'px';
    if (event.key == 's' && y < window.innerHeight - 60) p.style.top = (y + playerSpeed) + 'px';
">

<div id="menu">
    <h1>SHARK HUNTER</h1>
    <div id="highScoreDisplay" style="margin-bottom: 20px;"></div>
    <button onclick="selectMode(false)">STORY MODE</button>
    <button onclick="selectMode(true)">ENDLESS WAVE MODE</button>
</div>

<div id="healthContainer"><div id="healthBar"></div></div>

<div id="bossUI">
    <label>Great White Shark</label>
    <div id="bossHealthContainer"><div id="bossHealthBar"></div></div>
</div>

<div class="stats">
    <span id="waveDisplay"></span><br>
    <span id="scoreDisplay">Gold: 10</span>
</div>

<div id="shopOverlay" style="display:none;">
    <h1>SHOP OPEN</h1>
    <p>Gold: <span id="shopGold">0</span></p>
    <div class="shop-item"><h3>Full Heal</h3><p>5 Gold</p><button onclick="buy('health')">Buy</button></div>
    <div class="shop-item"><h3>Speed Boots</h3><p>10 Gold</p><button onclick="buy('speed')">Buy</button></div>
    <div class="shop-item"><h3>Triple Shot</h3><p>15 Gold</p><button onclick="buy('triple')">Buy</button></div>
    <br><button onclick="closeShop()" style="background: #4CAF50;">CONTINUE</button>
</div>

<div id="overlay"><h1>GAME OVER</h1><button onclick="location.reload()">RESTART</button></div>
<div id="victoryOverlay"><h1>VICTORY!</h1><p>The Ocean is Safe.</p><button onclick="location.reload()">MAIN MENU</button></div>

<img id="myImg01" src="ignore/meowl.png" onerror="fixImg(this, 'Player', 'orange')" style="position:absolute; width:60px; height:60px; left:50px; top:200px;">
<img id="bossShark" src="ignore/BaskingShark.jpg" onerror="fixImg(this, 'BOSS', 'red')" style="position:absolute; width:220px; height:120px; left:1200px; top:200px; border:4px solid red; display:none;">
<img id="myImg04" src="ignore/feller.jpg" onerror="fixImg(this, 'NPC', 'green')" style="position:absolute; width:60px; height:60px; left:1100px; top:500px; display:none;">

<div id="hp1" class="harpoon"></div>
<div id="hpB" class="harpoon"></div>
<div id="hpC" class="harpoon"></div>

</body>
</html>
