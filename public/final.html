<!DOCTYPE html>
<html>
<head>
<title>Shark Hunter: High Score Edition</title>
<style>
    body { background-color: #004d7a; overflow:hidden; margin:0; font-family: 'Segoe UI', sans-serif; }
    
    /* Added display:none so it doesn't show at start */
    #menu, #overlay, #shopOverlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,20,40,0.9); color: white; text-align: center; 
        padding-top: 10%; z-index: 200;
    }
    #overlay { display: none; } 

    #healthContainer {
        position: fixed; top: 20px; left: 20px; width: 200px; height: 25px; 
        background: #333; border: 2px solid white; z-index: 50;
    }
    #healthBar { width: 100%; height: 100%; background: #4CAF50; transition: width 0.3s; }
    
    .stats { 
        position: fixed; top: 10px; right: 20px; color: white; text-align: right;
        background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; font-size: 16px;
    }
    .best { color: #ffd700; font-weight: bold; font-size: 14px; }

    .harpoon {
        position: absolute; width: 40px; height: 6px; 
        background: linear-gradient(to right, #888, #eee, #333);
        border-radius: 2px; left: -500px; pointer-events: none;
    }
    .harpoon::after { 
        content: ''; position: absolute; right: -5px; top: -3px;
        border-left: 10px solid #555; border-top: 6px solid transparent; border-bottom: 6px solid transparent;
    }

    button { padding: 15px 30px; font-size: 18px; cursor: pointer; margin: 10px; background: #008CBA; color: white; border: none; border-radius: 8px; }
    .shop-item { display: inline-block; width: 200px; padding: 15px; border: 1px solid #008CBA; margin: 10px; background: rgba(255,255,255,0.1); }
</style>
<script>
   let myGold = 10;        // Separated Gold
   let playerHealth = 10;   // Separated Health
   let playerMaxHealth = 10;
   let bossHP = 5;
   let gameActive = false;
   let inShop = false;
   let endlessMode = false;
   let wave = 1;
   let enemyBaseSpeed = 0.8;
   let tripleShot = false;
   let playerSpeed = 25;
   let activeEnemies = [];

   function updateHighScores() {
       let bestWave = localStorage.getItem('sharkBestWave') || 0;
       let bestGold = localStorage.getItem('sharkBestGold') || 0;

       if (endlessMode && wave > bestWave) localStorage.setItem('sharkBestWave', wave);
       if (myGold > bestGold) localStorage.setItem('sharkBestGold', myGold);
       
       renderScoreboard();
   }

   function renderScoreboard() {
       let bWave = localStorage.getItem('sharkBestWave') || 0;
       let bGold = localStorage.getItem('sharkBestGold') || 0;
       
       document.getElementById('waveDisplay').innerText = endlessMode ? "Wave: " + wave : "Story Mode";
       document.getElementById('scoreDisplay').innerText = "Gold: " + myGold;
       document.getElementById('highScoreDisplay').innerHTML = 
           `<span class="best">BEST WAVE: ${bWave}</span><br><span class="best">BEST GOLD: ${bGold}</span>`;
   }

   function selectMode(isEndless) {
       endlessMode = isEndless;
       document.getElementById('menu').style.display = 'none';
       gameActive = true;
       if (endlessMode) { wave = 0; startWave(); } 
       else {
           document.getElementById('myImg04').style.display = 'block';
           document.getElementById('bossShark').style.display = 'block';
       }
       updateUI();
   }

   function updateUI() {
       let hBar = document.getElementById('healthBar');
       let pct = (playerHealth / playerMaxHealth) * 100;
       hBar.style.width = Math.max(0, pct) + "%";
       hBar.style.background = pct < 30 ? "#ff4444" : "#4CAF50";
       renderScoreboard();
   }

   function startWave() {
       wave++;
       enemyBaseSpeed += 0.15;
       let count = 3 + wave; 
       activeEnemies.forEach(id => { let e = document.getElementById(id); if (e) e.remove(); });
       activeEnemies = [];
       for (let i = 0; i < count; i++) { spawnShark('shark' + i); }
       if (wave % 5 === 0) spawnBoss();
       updateUI();
   }

   function spawnShark(id) {
       let img = document.createElement('img');
       img.id = id;
       img.src = "https://via.placeholder.com/80x40/blue/white?text=Shark"; // Placeholder if image missing
       img.style.position = "absolute"; img.style.width = "80px"; img.style.height = "40px";
       img.style.left = (window.innerWidth + Math.random() * 500) + "px";
       img.style.top = Math.random() * (window.innerHeight - 100) + "px";
       document.body.appendChild(img);
       activeEnemies.push(id);
   }

   function spawnBoss() {
        let b = document.getElementById('bossShark');
        b.style.display = 'block'; b.style.left = "1200px";
        bossHP = 5 + (wave * 2);
   }

   function myHitOther(my1, my2) {
       const b1 = document.getElementById(my1).getBoundingClientRect();
       const b2 = document.getElementById(my2).getBoundingClientRect();
       return !(b1.right < b2.left || b1.left > b2.right || b1.bottom < b2.top || b1.top > b2.bottom);
   }

   function myShoot(event) {
       if (!gameActive || inShop) return;
       let p = document.getElementById('myImg01').getBoundingClientRect();
       let sX = p.left + 30, sY = p.top + 30;
       let dX = event.clientX - sX, dY = event.clientY - sY;
       let angle = Math.atan2(dY, dX);
       let dist = Math.sqrt(dX*dX + dY*dY);
       let vX = (dX/dist)*18, vY = (dY/dist)*18;

       fireHarpoon('hp1', sX, sY, vX, vY, angle);
       if (tripleShot) {
           fireHarpoon('hpB', sX, sY, (dX/dist)*18, (dY/dist)*18 - 3, angle - 0.1);
           fireHarpoon('hpC', sX, sY, (dX/dist)*18, (dY/dist)*18 + 3, angle + 0.1);
       }
   }

   function fireHarpoon(id, sX, sY, vX, vY, angle) {
       let h = document.getElementById(id);
       h.style.left = sX + 'px'; h.style.top = sY + 'px';
       h.style.transform = `rotate(${angle}rad)`;
       let timer = setInterval(() => {
           if (!gameActive || inShop) { clearInterval(timer); return; }
           h.style.left = parseFloat(h.style.left) + vX + 'px';
           h.style.top = parseFloat(h.style.top) + vY + 'px';
           activeEnemies.forEach((eId, index) => {
               if (myHitOther(id, eId)) { h.style.left = "-500px"; clearInterval(timer); killEnemy(eId, index); }
           });
           if (myHitOther(id, 'bossShark')) {
               h.style.left = "-500px"; clearInterval(timer); bossHP--;
               if (bossHP <= 0) { document.getElementById('bossShark').style.display = 'none'; myGold += 20; updateUI(); }
           }
       }, 20);
       setTimeout(() => { clearInterval(timer); h.style.left = "-500px"; }, 6000);
   }

   function killEnemy(id, index) {
       let e = document.getElementById(id); if (!e) return;
       e.remove(); activeEnemies.splice(index, 1);
       myGold += 2; updateUI();
       if (endlessMode && activeEnemies.length === 0) { if (wave % 2 === 0) openShop(); else startWave(); }
   }

   function openShop() { inShop = true; document.getElementById('shopOverlay').style.display = 'block'; document.getElementById('shopGold').innerText = myGold; }
   function closeShop() { inShop = false; document.getElementById('shopOverlay').style.display = 'none'; startWave(); }
   
   function buy(item) {
       if (item === 'health' && myGold >= 5) { myGold -= 5; playerHealth = playerMaxHealth; }
       else if (item === 'speed' && myGold >= 10) { myGold -= 10; playerSpeed += 8; }
       else if (item === 'triple' && myGold >= 15) { myGold -= 15; tripleShot = true; }
       updateUI(); document.getElementById('shopGold').innerText = myGold;
   }

   setInterval(() => {
       if (!gameActive || inShop) return;
       let p = document.getElementById('myImg01');
       let top = parseFloat(p.style.top || 200);
       if (top < 550) p.style.top = (top + 2) + 'px';
       
       activeEnemies.forEach(id => {
           let e = document.getElementById(id);
           if(!e) return;
           let ex = parseFloat(e.style.left), ey = parseFloat(e.style.top);
           let px = parseFloat(p.style.left), py = parseFloat(p.style.top);
           e.style.left = (ex < px ? ex + enemyBaseSpeed : ex - enemyBaseSpeed) + 'px';
           e.style.top = (ey < py ? ey + enemyBaseSpeed : ey - enemyBaseSpeed) + 'px';
           
           if (myHitOther('myImg01', id)) { 
               p.style.left = '20px'; 
               playerHealth -= 1; // Take damage instead of losing gold
               updateUI(); 
           }
       });

       if (playerHealth <= 0) { 
           gameActive = false; 
           updateHighScores();
           document.getElementById('overlay').style.display='block'; 
       }
   }, 40);

   window.onload = renderScoreboard;
</script>
</head>

<body onclick="myShoot(event)" onkeydown="
    if(!gameActive || inShop) return;
    let p = document.getElementById('myImg01');
    if (event.key == 'd') p.style.left = (parseFloat(p.style.left)||0) + playerSpeed + 'px';
    if (event.key == 'a') p.style.left = (parseFloat(p.style.left)||0) - playerSpeed + 'px';
    if (event.key == 'w') p.style.top = (parseFloat(p.style.top)||0) - 60 + 'px';
    if (event.key == 's') p.style.top = (parseFloat(p.style.top)||0) + playerSpeed + 'px';
">

<div id="menu">
    <h1>SHARK HUNTER</h1>
    <div id="highScoreDisplay" style="margin-bottom: 20px;"></div>
    <button onclick="selectMode(false)">STORY MODE</button>
    <button onclick="selectMode(true)">ENDLESS WAVE MODE</button>
</div>

<div id="healthContainer"><div id="healthBar"></div></div>
<div class="stats">
    <span id="waveDisplay"></span><br>
    <span id="scoreDisplay">Gold: 10</span>
</div>

<div id="shopOverlay" style="display:none;">
    <h1>SHOP OPEN</h1>
    <p>Gold: <span id="shopGold">0</span></p>
    <div class="shop-item"><h3>Full Heal</h3><p>5 Gold</p><button onclick="buy('health')">Buy</button></div>
    <div class="shop-item"><h3>Speed Boots</h3><p>10 Gold</p><button onclick="buy('speed')">Buy</button></div>
    <div class="shop-item"><h3>Triple Shot</h3><p>15 Gold</p><button onclick="buy('triple')">Buy</button></div>
    <br><button onclick="closeShop()" style="background: #4CAF50;">CONTINUE</button>
</div>

<div id="overlay">
    <h1>GAME OVER</h1>
    <button onclick="location.reload()">RESTART</button>
</div>

<img id="myImg01" src="ignore/meowl.png" style="position:absolute; width:60px; height:60px; left:50px; top:200px;">
<img id="bossShark" src="ignore/BaskingShark.jpg" style="position:absolute; width:220px; height:120px; left:1200px; top:200px; border:4px solid red; display:none;">
<img id="myImg04" src="ignore/feller.jpg" style="position:absolute; width:60px; height:60px; left:1100px; top:500px; display:none;">

<div id="hp1" class="harpoon"></div>
<div id="hpB" class="harpoon"></div>
<div id="hpC" class="harpoon"></div>

</body>
</html>
