<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Message Encryption / Decryption</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            max-width: 700px;
        }
        textarea {
            width: 100%;
            height: 120px;
            margin-bottom: 10px;
            font-size: 15px;
        }
        input {
            width: 100%;
            margin-bottom: 10px;
            padding: 6px;
            font-size: 15px;
        }
        button {
            padding: 10px 15px;
            font-size: 15px;
            cursor: pointer;
            margin-right: 10px;
        }
        .section {
            border: 1px solid #ccc;
            padding: 20px;
            margin-bottom: 40px;
            border-radius: 6px;
            background: #fafafa;
        }
    </style>
</head>
<body>

<h1>üîê Message Encryption / Decryption</h1>

<div class="section">
    <h2>Encrypt Message (AES-GCM)</h2>
    <textarea id="encryptInput" placeholder="Enter text to encrypt..."></textarea>
    <input id="encryptPassword" type="password" placeholder="Password">
    <button onclick="encryptMessage()">Encrypt</button>
    <textarea id="encryptOutput" placeholder="Encrypted text appears here..." readonly></textarea>
</div>

<div class="section">
    <h2>Decrypt Message (AES-GCM)</h2>
    <textarea id="decryptInput" placeholder="Paste encrypted text here..."></textarea>
    <input id="decryptPassword" type="password" placeholder="Password">
    <button onclick="decryptMessage()">Decrypt</button>
    <textarea id="decryptOutput" placeholder="Decrypted text appears here..." readonly></textarea>
</div>

<div class="section">
    <h2>Caesar Cipher (No Password)</h2>
    <textarea id="caesarInput" placeholder="Enter text..."></textarea>
    <input id="caesarShift" type="number" placeholder="Shift amount (e.g. 3)">
    <button onclick="caesarEncrypt()">Encrypt (Caesar)</button>
    <button onclick="caesarDecrypt()">Decrypt (Caesar)</button>
    <textarea id="caesarOutput" placeholder="Result appears here..." readonly></textarea>
</div>

<script>
// ================= AES-GCM FUNCTIONS =================
async function getKey(password, salt) {
    const encoder = new TextEncoder();

    const baseKey = await crypto.subtle.importKey(
        "raw",
        encoder.encode(password),
        { name: "PBKDF2" },
        false,
        ["deriveKey"]
    );

    return crypto.subtle.deriveKey(
        {
            name: "PBKDF2",
            salt: salt,
            iterations: 100000,
            hash: "SHA-256"
        },
        baseKey,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt", "decrypt"]
    );
}

async function encryptMessage() {
    const message = document.getElementById("encryptInput").value;
    const password = document.getElementById("encryptPassword").value;
    if (!message || !password) return alert("Enter message AND password.");

    const encoder = new TextEncoder();
    const data = encoder.encode(message);

    const salt = crypto.getRandomValues(new Uint8Array(16));
    const iv = crypto.getRandomValues(new Uint8Array(12));

    const key = await getKey(password, salt);

    const encrypted = await crypto.subtle.encrypt(
        { name: "AES-GCM", iv: iv },
        key,
        data
    );

    const combined = new Uint8Array([
        ...salt,
        ...iv,
        ...new Uint8Array(encrypted)
    ]);

    document.getElementById("encryptOutput").value =
        btoa(String.fromCharCode(...combined));
}

async function decryptMessage() {
    try {
        const encryptedB64 = document.getElementById("decryptInput").value;
        const password = document.getElementById("decryptPassword").value;
        if (!encryptedB64 || !password) return alert("Enter encrypted text AND password.");

        const encryptedData = Uint8Array.from(atob(encryptedB64), c => c.charCodeAt(0));

        const salt = encryptedData.slice(0, 16);
        const iv = encryptedData.slice(16, 28);
        const ciphertext = encryptedData.slice(28);

        const key = await getKey(password, salt);

        const decrypted = await crypto.subtle.decrypt(
            { name: "AES-GCM", iv: iv },
            key,
            ciphertext
        );

        const decoder = new TextDecoder();
        document.getElementById("decryptOutput").value = decoder.decode(decrypted);

    } catch (err) {
        document.getElementById("decryptOutput").value = "‚ùå Incorrect password or corrupt data";
    }
}

// ================= CAESAR CIPHER =================
function caesarShiftChar(c, shift) {
    const code = c.charCodeAt(0);

    // Uppercase A-Z
    if (code >= 65 && code <= 90)
        return String.fromCharCode(((code - 65 + shift) % 26 + 26) % 26 + 65);

    // Lowercase a-z
    if (code >= 97 && code <= 122)
        return String.fromCharCode(((code - 97 + shift) % 26 + 26) % 26 + 97);

    return c; // Non-letter
}

function caesarEncrypt() {
    const text = document.getElementById("caesarInput").value;
    const shift = parseInt(document.getElementById("caesarShift").value) || 0;

    const result = [...text].map(ch => caesarShiftChar(ch, shift)).join("");
    document.getElementById("caesarOutput").value = result;
}

function caesarDecrypt() {
    const text = document.getElementById("caesarInput").value;
    const shift = parseInt(document.getElementById("caesarShift").value) || 0;

    const result = [...text].map(ch => caesarShiftChar(ch, -shift)).join("");
    document.getElementById("caesarOutput").value = result;
}
</script>

</body>
</html>
